<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Kana Practice (Mobile PWA)</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0066ff" />

<style>
:root{
  --bg: #f5f7fb;
  --card: #ffffff;
  --text: #111827;
  --muted: #6b7280;
  --accent: #0066ff;
  --button-bg: #0066ff;
  --button-text: #ffffff;
  --tab-active: #0066ff;
}
[data-theme="dark"]{
  --bg: #0b1220;
  --card: #071127;
  --text: #e6eef8;
  --muted: #9aa7bb;
  --accent: #3390ff;
  --button-bg: #1a6cff;
  --button-text: #fff;
  --tab-active: #1a6cff;
}

html,body{height:100%; margin:0; background:var(--bg); color:var(--text); -webkit-font-smoothing:antialiased;}
.app {
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:12px;
  box-sizing:border-box;
}
/* Card container */
.card{
  width:100%;
  max-width:520px;
  background:var(--card);
  border-radius:14px;
  box-shadow: 0 8px 24px rgba(2,6,23,0.08);
  padding:12px;
  box-sizing:border-box;
  display:flex;
  flex-direction:column;
  gap:8px;
}

/* header */
.header {
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:8px;
  padding:6px 4px;
}
.title { font-size:18px; font-weight:600; }
.controls { display:flex; gap:6px; align-items:center; }

/* tabs */
.tabs {
  display:flex;
  gap:8px;
  justify-content:center;
  margin:6px 0 2px;
}
.tab {
  flex:1;
  text-align:center;
  padding:10px 8px;
  border-radius:10px;
  border:1px solid rgba(0,0,0,0.06);
  background:transparent;
  font-weight:600;
  cursor:pointer;
  user-select:none;
}
.tab.active {
  background:var(--tab-active);
  color:white;
  box-shadow:0 6px 16px rgba(6,30,84,0.08);
}

/* question & answer */
.q-area {
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:6px;
  padding:6px;
}
#question {
  font-size:36px;
  font-weight:700;
  letter-spacing:0.6px;
  margin-top:4px;
}
#answer {
  font-size:36px;
  color:var(--muted);
  display:none;
}

/* big controls (buttons) */
.actions {
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  justify-content:center;
  margin-top:6px;
}
.btn {
  flex: 0 0 48%;
  padding:12px 10px;
  border-radius:12px;
  border:none;
  font-size:16px;
  font-weight:700;
  background:var(--button-bg);
  color:var(--button-text);
  cursor:pointer;
}
.btn.secondary { background:transparent; color:var(--text); border:1px solid rgba(0,0,0,0.08); }
.btn.small { flex: 0 0 30%; font-size:14px; padding:8px; }

/* drawing area */
.canvas-wrap {
  width:100%;
  display:flex;
  justify-content:center;
  margin-top:6px;
}
canvas#draw {
  width:100%;
  height:50vh; /* large drawing area */
  max-height:520px;
  background:linear-gradient(180deg, rgba(0,0,0,0.01), rgba(0,0,0,0.02));
  border-radius:10px;
  border:1px solid rgba(0,0,0,0.06);
  touch-action:none;
}

/* footer small */
.footer {
  margin-top:8px;
  font-size:12px;
  color:var(--muted);
  text-align:center;
  padding-bottom:8px;
}

/* responsive tweaks */
@media(min-width:720px){
  #question{ font-size:48px; }
  #answer{ font-size:44px; }
  .btn{ font-size:18px; }
}
</style>
</head>
<body>
<div class="app" id="app">
  <div class="card" role="application">
    <div class="header">
      <div class="title">Kana Practice</div>
      <div class="controls">
        <button id="darkToggle" class="btn small secondary" title="Toggle dark mode">Dark</button>
        <button id="speakBtn" class="btn small secondary" title="Play pronunciation">üîä</button>
      </div>
    </div>

    <div class="tabs" role="tablist" aria-label="Practice mode">
      <div class="tab active" data-mode="hiragana">Hiragana</div>
      <div class="tab" data-mode="katakana">Katakana</div>
      <div class="tab" data-mode="both">Both</div>
    </div>

    <div class="q-area">
      <div id="question">Press Next</div>
      <div id="answer" aria-live="polite"></div>
    </div>

    <div class="actions" aria-hidden="false">
      <button id="showBtn" class="btn">Show Answer</button>
      <button id="nextBtn" class="btn">Next</button>
      <button id="clearBtn" class="btn secondary">Clear Drawing</button>
    </div>

    <div class="canvas-wrap">
      <canvas id="draw" aria-label="Drawing area for kana practice"></canvas>
    </div>

    <div class="footer">Both mode shows <strong>Hiragana / Katakana</strong> together (e.g. „ÅÇ / „Ç¢). Audio uses your browser's speech voice (Japanese).</div>
  </div>
</div>

<script>
/* ---------- Kana data (comprehensive) ----------
   This array includes:
   - basic vowels/consonants
   - dakuten (g, z, d, b), handakuten (p)
   - common contracted small-kana combos (kya, sha, cha, etc.)
   Expandable if you want more later.
*/

// helper to create pairs quickly
function pairs(list){ return list.map(x=>[x[0], x[1]]); }

const hiraganaList = pairs([
  ['a','„ÅÇ'],['i','„ÅÑ'],['u','„ÅÜ'],['e','„Åà'],['o','„Åä'],
  ['ka','„Åã'],['ki','„Åç'],['ku','„Åè'],['ke','„Åë'],['ko','„Åì'],
  ['sa','„Åï'],['shi','„Åó'],['su','„Åô'],['se','„Åõ'],['so','„Åù'],
  ['ta','„Åü'],['chi','„Å°'],['tsu','„Å§'],['te','„Å¶'],['to','„Å®'],
  ['na','„Å™'],['ni','„Å´'],['nu','„Å¨'],['ne','„Å≠'],['no','„ÅÆ'],
  ['ha','„ÅØ'],['hi','„Å≤'],['fu','„Åµ'],['he','„Å∏'],['ho','„Åª'],
  ['ma','„Åæ'],['mi','„Åø'],['mu','„ÇÄ'],['me','„ÇÅ'],['mo','„ÇÇ'],
  ['ya','„ÇÑ'],['yu','„ÇÜ'],['yo','„Çà'],
  ['ra','„Çâ'],['ri','„Çä'],['ru','„Çã'],['re','„Çå'],['ro','„Çç'],
  ['wa','„Çè'],['wo','„Çí'],['n','„Çì'],

  // dakuten (voiced)
  ['ga','„Åå'],['gi','„Åé'],['gu','„Åê'],['ge','„Åí'],['go','„Åî'],
  ['za','„Åñ'],['ji','„Åò'],['zu','„Åö'],['ze','„Åú'],['zo','„Åû'],
  ['da','„Å†'],['di','„Å¢'],['du','„Å•'],['de','„Åß'],['do','„Å©'],
  ['ba','„Å∞'],['bi','„Å≥'],['bu','„Å∂'],['be','„Åπ'],['bo','„Åº'],

  // handakuten (p)
  ['pa','„Å±'],['pi','„Å¥'],['pu','„Å∑'],['pe','„Å∫'],['po','„ÅΩ'],

  // contracted (small kana combos)
  ['kya','„Åç„ÇÉ'],['kyu','„Åç„ÇÖ'],['kyo','„Åç„Çá'],
  ['sha','„Åó„ÇÉ'],['shu','„Åó„ÇÖ'],['sho','„Åó„Çá'],
  ['cha','„Å°„ÇÉ'],['chu','„Å°„ÇÖ'],['cho','„Å°„Çá'],
  ['nya','„Å´„ÇÉ'],['nyu','„Å´„ÇÖ'],['nyo','„Å´„Çá'],
  ['hya','„Å≤„ÇÉ'],['hyu','„Å≤„ÇÖ'],['hyo','„Å≤„Çá'],
  ['mya','„Åø„ÇÉ'],['myu','„Åø„ÇÖ'],['myo','„Åø„Çá'],
  ['rya','„Çä„ÇÉ'],['ryu','„Çä„ÇÖ'],['ryo','„Çä„Çá'],
  ['gya','„Åé„ÇÉ'],['gyu','„Åé„ÇÖ'],['gyo','„Åé„Çá'],
  ['bya','„Å≥„ÇÉ'],['byu','„Å≥„ÇÖ'],['byo','„Å≥„Çá'],
  ['pya','„Å¥„ÇÉ'],['pyu','„Å¥„ÇÖ'],['pyo','„Å¥„Çá'],
  ['ja','„Åò„ÇÉ'],['ju','„Åò„ÇÖ'],['jo','„Åò„Çá'],
  // small kana standalone (practice small kana if you want)
  ['small-ya','„ÇÉ'],['small-yu','„ÇÖ'],['small-yo','„Çá'],['small-tsu','„Å£']
]);

const katakanaList = pairs([
  ['a','„Ç¢'],['i','„Ç§'],['u','„Ç¶'],['e','„Ç®'],['o','„Ç™'],
  ['ka','„Ç´'],['ki','„Ç≠'],['ku','„ÇØ'],['ke','„Ç±'],['ko','„Ç≥'],
  ['sa','„Çµ'],['shi','„Ç∑'],['su','„Çπ'],['se','„Çª'],['so','„ÇΩ'],
  ['ta','„Çø'],['chi','„ÉÅ'],['tsu','„ÉÑ'],['te','„ÉÜ'],['to','„Éà'],
  ['na','„Éä'],['ni','„Éã'],['nu','„Éå'],['ne','„Éç'],['no','„Éé'],
  ['ha','„Éè'],['hi','„Éí'],['fu','„Éï'],['he','„Éò'],['ho','„Éõ'],
  ['ma','„Éû'],['mi','„Éü'],['mu','„É†'],['me','„É°'],['mo','„É¢'],
  ['ya','„É§'],['yu','„É¶'],['yo','„É®'],
  ['ra','„É©'],['ri','„É™'],['ru','„É´'],['re','„É¨'],['ro','„É≠'],
  ['wa','„ÉØ'],['wo','„É≤'],['n','„É≥'],

  ['ga','„Ç¨'],['gi','„ÇÆ'],['gu','„Ç∞'],['ge','„Ç≤'],['go','„Ç¥'],
  ['za','„Ç∂'],['ji','„Ç∏'],['zu','„Ç∫'],['ze','„Çº'],['zo','„Çæ'],
  ['da','„ÉÄ'],['di','„ÉÇ'],['du','„ÉÖ'],['de','„Éá'],['do','„Éâ'],
  ['ba','„Éê'],['bi','„Éì'],['bu','„Éñ'],['be','„Éô'],['bo','„Éú'],
  ['pa','„Éë'],['pi','„Éî'],['pu','„Éó'],['pe','„Éö'],['po','„Éù'],

  ['kya','„Ç≠„É£'],['kyu','„Ç≠„É•'],['kyo','„Ç≠„Éß'],
  ['sha','„Ç∑„É£'],['shu','„Ç∑„É•'],['sho','„Ç∑„Éß'],
  ['cha','„ÉÅ„É£'],['chu','„ÉÅ„É•'],['cho','„ÉÅ„Éß'],
  ['nya','„Éã„É£'],['nyu','„Éã„É•'],['nyo','„Éã„Éß'],
  ['hya','„Éí„É£'],['hyu','„Éí„É•'],['hyo','„Éí„Éß'],
  ['mya','„Éü„É£'],['myu','„Éü„É•'],['myo','„Éü„Éß'],
  ['rya','„É™„É£'],['ryu','„É™„É•'],['ryo','„É™„Éß'],
  ['gya','„ÇÆ„É£'],['gyu','„ÇÆ„É•'],['gyo','„ÇÆ„Éß'],
  ['bya','„Éì„É£'],['byu','„Éì„É•'],['byo','„Éì„Éß'],
  ['pya','„Éî„É£'],['pyu','„Éî„É•'],['pyo','„Éî„Éß'],
  ['ja','„Ç∏„É£'],['ju','„Ç∏„É•'],['jo','„Ç∏„Éß'],
  ['small-ya','„É£'],['small-yu','„É•'],['small-yo','„Éß'],['small-tsu','„ÉÉ']
]);

/* app state */
let currentMode = 'hiragana';
let currentPool = hiraganaList.slice();
let current = null;

/* DOM refs */
const tabs = document.querySelectorAll('.tab');
const qEl = document.getElementById('question');
const aEl = document.getElementById('answer');
const showBtn = document.getElementById('showBtn');
const nextBtn = document.getElementById('nextBtn');
const clearBtn = document.getElementById('clearBtn');
const darkToggle = document.getElementById('darkToggle');
const speakBtn = document.getElementById('speakBtn');

/* =========== Dark mode (persist) =========== */
function loadTheme(){
  const t = localStorage.getItem('kana-theme') || 'light';
  if(t === 'dark') document.documentElement.setAttribute('data-theme','dark');
}
function toggleTheme(){
  const cur = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'light';
  const next = cur === 'dark' ? 'light' : 'dark';
  document.documentElement.setAttribute('data-theme', next);
  localStorage.setItem('kana-theme', next);
}
darkToggle.addEventListener('click', toggleTheme);
loadTheme();

/* =========== Tabs =========== */
tabs.forEach(t => t.addEventListener('click', () => {
  const mode = t.dataset.mode || t.innerText.toLowerCase();
  setMode(mode);
}));

function setMode(mode){
  currentMode = mode;
  tabs.forEach(t => t.classList.toggle('active', t.dataset.mode === mode));
  if(mode === 'hiragana') currentPool = hiraganaList.slice();
  else if(mode === 'katakana') currentPool = katakanaList.slice();
  else currentPool = hiraganaList.concat(katakanaList);
  nextQuestion();
}

/* =========== Quiz logic =========== */
function nextQuestion(){
  if(!currentPool || currentPool.length === 0) return;
  current = currentPool[Math.floor(Math.random()*currentPool.length)];
  qEl.textContent = current[0];
  aEl.style.display = 'none';
  aEl.textContent = '';
  clearCanvas();
}
function showAnswer(){
  if(!current) return;
  if(currentMode === 'both'){
    const h = hiraganaList.find(x=>x[0] === current[0]);
    const k = katakanaList.find(x=>x[0] === current[0]);
    aEl.textContent = `${h ? h[1] : ''} / ${k ? k[1] : ''}`;
  } else {
    aEl.textContent = current[1];
  }
  aEl.style.display = 'block';
}

showBtn.addEventListener('click', showAnswer);
nextBtn.addEventListener('click', nextQuestion);

/* =========== Audio Pronunciation (Web Speech API) =========== */
function speakCurrent(){
  if(!current) return;
  // prefer speaking the hiragana if available, otherwise katakana.
  // For BOTH mode speak the hiragana (native) by default.
  let textToSpeak;
  if(currentMode === 'katakana') textToSpeak = (katakanaList.find(x=>x[0]===current[0]) || [null,''])[1];
  else textToSpeak = (hiraganaList.find(x=>x[0]===current[0]) || [null,''])[1];
  if(!textToSpeak) textToSpeak = current[1];
  if('speechSynthesis' in window){
    const u = new SpeechSynthesisUtterance(textToSpeak);
    u.lang = 'ja-JP';
    // adjust voice rate/volume if you want
    u.rate = 0.9;
    window.speechSynthesis.cancel(); // stop previous
    window.speechSynthesis.speak(u);
  } else {
    alert('Speech not supported in this browser');
  }
}
speakBtn.addEventListener('click', speakCurrent);

/* =========== Drawing canvas (hi-dpi) =========== */
const canvas = document.getElementById('draw');
const ctx = canvas.getContext('2d');

function resizeCanvas(){
  const ratio = window.devicePixelRatio || 1;
  const rect = canvas.getBoundingClientRect();
  canvas.width = Math.round(rect.width * ratio);
  canvas.height = Math.round(rect.height * ratio);
  ctx.scale(ratio, ratio);
  // set default stroke style
  ctx.strokeStyle = window.getComputedStyle(document.documentElement).getPropertyValue('--text') || '#111';
  ctx.lineWidth = 8;
  ctx.lineCap = 'round';
}
window.addEventListener('resize', () => { resizeCanvas(); });
resizeCanvas();

let drawing = false;
function getPointerPos(e){
  const rect = canvas.getBoundingClientRect();
  if(e.touches && e.touches.length) {
    return {x: e.touches[0].clientX - rect.left, y: e.touches[0].clientY - rect.top};
  }
  return {x: e.clientX - rect.left, y: e.clientY - rect.top};
}
canvas.addEventListener('pointerdown', (e) => {
  drawing = true;
  const p = getPointerPos(e);
  ctx.beginPath();
  ctx.moveTo(p.x, p.y);
});
canvas.addEventListener('pointermove', (e) => {
  if(!drawing) return;
  const p = getPointerPos(e);
  ctx.lineTo(p.x, p.y);
  ctx.stroke();
});
canvas.addEventListener('pointerup', ()=> drawing = false);
canvas.addEventListener('pointercancel', ()=> drawing = false);

function clearCanvas(){
  // clear with full resolution
  const rect = canvas.getBoundingClientRect();
  ctx.clearRect(0,0,rect.width, rect.height);
}

/* wire clear button */
clearBtn.addEventListener('click', clearCanvas);

/* install service worker if available: (registered in manifest link)
   note: file name in sw.js (below) should be 'sw.js' in the same folder
*/
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js').catch(()=>{/* ignore */});
}

/* initialize */
setMode('hiragana');
</script>
</body>
</html>
